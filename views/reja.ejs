<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rejalar</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <style>
      /* Modallar */
      .modal-todo {
        position: fixed;
        max-width: 500px;
        width: 90%;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(34, 34, 34, 0.5);
        backdrop-filter: blur(3px);
        z-index: 50;
      }

      .hidden {
        display: none;
      }

      /* List itemlar */
      #item-list li {
        flex-wrap: wrap;
      }

      #item-list li div {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
      }

      .item-text {
        word-break: break-word;
        margin-right: 10px;
      }

      /* Tugmalar */
      button {
        cursor: pointer;
      }

      /* Mobil uchun maxsus */
      @media (max-width: 576px) {
        h1.display-4 {
          font-size: 1.8rem;
        }

        #create-field {
          font-size: 0.9rem;
          margin-bottom: 5px;
        }

        #create-form .btn {
          font-size: 0.85rem;
          padding: 0.35rem 0.6rem;
        }

        #item-list li {
          font-size: 0.85rem;
          flex-direction: column;
          align-items: flex-start;
        }

        #item-list li div {
          flex-direction: column;
          align-items: flex-start;
          margin-top: 5px;
        }

        .modal-todo {
          width: 95%;
          top: 35%;
        }

        .modal-todo h4 {
          font-size: 1rem;
        }

        .modal-todo .btn {
          font-size: 0.85rem;
          padding: 0.35rem 0.6rem;
        }

        #clean-all {
          font-size: 0.85rem;
          padding: 0.35rem 0.6rem;
        }
      }

      /* Tabletlarga moslash */
      @media (max-width: 768px) {
        #create-field {
          flex: 1 1 100%;
        }

        #create-form .d-flex {
          flex-direction: column;
        }

        #create-form .btn {
          width: 100%;
          margin-top: 5px;
        }
      }
    </style>
  </head>
  <body style="background-color: white">
    <div class="container-lg">
      <h1 class="display-4 text-center py-1">Reja va Maqsadlar</h1>

      <div class="mb-3">
        <form id="create-form" action="/create-item" method="POST">
          <div class="d-flex align-items-center">
            <input
              id="create-field"
              name="reja"
              autocomplete="off"
              class="mb-1 form-control"
              type="text"
              style="flex: 1"
              placeholder="Reja kiriting..."
            />
            <button class="btn btn-outline-primary d-block ms-auto">
              Yangi Reja Qo'shish
            </button>
          </div>
        </form>
        <span id="message-edit" class="text-danger fw-bold mt-1 d-block"></span>
      </div>

      <ul id="item-list" class="list-group pb-3">
        <% items.map(function(item) { %>
        <li
          class="list-group-item list-group-item-action list-group-item-info d-flex align-items-center justify-content-between"
        >
          <span class="item-text"><%= item.reja%></span>
          <div>
            <span class="item-text"><%= item.time%></span>
            <button
              data-id="<%=item._id%>"
              class="edit-me btn btn-outline-success btn-sm mr-1"
            >
              O‘zgartirish
            </button>
            <button
              data-id="<%=item._id%>"
              class="delete-me btn btn-outline-danger btn-sm"
            >
              O‘chirish
            </button>
          </div>
        </li>
        <% }) %>
      </ul>

      <button
        id="clean-all"
        class="btn btn-outline-danger"
        style="border-radius: 20px"
      >
        Hamma Rejalarni O'chirish
      </button>

      <!-- Modals -->
      <div class="modal-todo hidden" id="modal-delete">
        <div class="card">
          <div class="card-header text-center">
            <h4>Rejani o'chirishni xohlaysizmi?</h4>
          </div>
          <div class="card-body d-flex justify-content-between">
            <button id="no-delete" class="btn btn-outline-primary">Yo'q</button>
            <button id="yes-delete" class="btn btn-outline-danger">
              Ha, o'chiramam
            </button>
          </div>
        </div>
      </div>

      <!-- Edit Modal -->
      <div class="modal-todo hidden" id="modal-edit">
        <div class="card">
          <div class="card-header text-center">
            <h4>Rejani o‘zgartirish</h4>
          </div>
          <div class="card-body">
            <form id="save-change">
              <div class="mb-3">
                <input
                  id="input-edit"
                  type="text"
                  class="form-control"
                  placeholder="Yangi reja nomini kiriting..."
                />
                <span
                  id="edit-message"
                  class="text-danger fw-bold mt-2 d-block"
                ></span>
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-outline-success me-2">
                  Saqlash
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  onclick="document.getElementById('modal-edit').classList.add('hidden'); document.getElementById('overlay').classList.add('hidden');"
                >
                  Bekor qilish
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div id="overlay" class="overlay hidden"></div>

      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <script src="/browser.js"></script>
    </div>
  </body>
</html>
